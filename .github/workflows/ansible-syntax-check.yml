name: Ansible syntax check
on:
  pull_request:
    paths:
    - ansible/**
defaults:
  run:
    shell: bash
jobs:
  ansible-syntax:
    runs-on: self-hosted
    permissions:
      contents: read
    timeout-minutes: 20
    steps:
    - name: Checkout repository
      uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8
    - name: Set up Python
      uses: actions/setup-python@83679a892e2d95755f2dac6acb0bfd1e9ac5d548
      with:
        python-version: '3.12'
    - name: Cache pip
      uses: actions/cache@a7833574556fa59680c1b7cb190c1735db73ebf0
      with:
        path: ~/.cache/pip
        key: pip-${{ runner.os }}-py312-ansible
        restore-keys: 'pip-${{ runner.os }}-

          '
    - name: Install Ansible
      run: 'python -m pip install --upgrade pip

        pip install ansible

        pip install ansible-lint yamllint

        '
    - name: Run Ansible syntax check
      run: 'ansible-playbook --syntax-check ansible/rotate-tsig-ha.yml ansible/playbooks/*.yml

        '
    - name: Run ansible-lint and yamllint
      run: 'ansible-lint ansible

        yamllint ansible

        '