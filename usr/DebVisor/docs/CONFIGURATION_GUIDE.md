# etc/ Configuration Directory - Improvements\n\n## Overview\n\nThe `etc/` directory contains service configurations, timers, and operational documentation.\n\n## Directory Structure\n\n    etc/\n    +-- blocklist.d/               # Blocklist definitions\n    +-- debvisor/                  # Main configuration\n    +-- systemd/\n    |   +-- system/\n    |   |   +-- debvisor-*.service\n    |   |   +-- debvisor-*.timer\n    |   |   +-- system.conf.d/\n    |   +-- user/\n    +-- README.md                  # Configuration documentation\n    +-- VALIDATION_GUIDE.md        # Validation procedures\n\n## Blocklist Management\n\n### Blocklist Files\n\n### etc/blocklist.d/nodes.blocklist\n\n## Format: one node per line\n\n## Lines starting with # are comments\n\n    node-123\n    node-456\n\n## Reason: Hardware failure\n\n    node-789\n\n## etc/blocklist.d/networks.blocklist\n\n## CIDR format for network ranges\n\n    192.168.1.0/24\n    10.0.0.0/8\n\n## IPv6 support\n\n    fc00::/7\n\n## etc/blocklist.d/storage.blocklist\n\n## Storage devices or pools to exclude\n\n    /dev/sdb\n    ceph-pool-backup\n    zfs-tank-old\n\n## Blocklist Validation\n\n## Validate all blocklist files\n\n    python3 opt/config/validate-blocklist.py --dir etc/blocklist.d/\n\n## Check specific file\n\n    python3 opt/config/validate-blocklist.py --file etc/blocklist.d/nodes.blocklist\n\n## Apply blocklist\n\n    debvisor-blocklist-apply etc/blocklist.d/\n\n## Service Configuration\n\n### Service Files\n\n- *debvisor-rpcd.service**- RPC daemon\n\n    [Unit]\n    Description=DebVisor RPC Service\n    After=network-online.target\n    Requires=network-online.target\n    [Service]\n    Type=simple\n    User=debvisor\n    ExecStart=/opt/services/rpc/bin/rpcd --config /etc/debvisor/rpcd.conf\n    Restart=always\n    RestartSec=10s\n    [Install]\n    WantedBy=multi-user.target\n\n- *debvisor-panel.service**- Web panel\n\n    [Unit]\n    Description=DebVisor Web Panel\n    After=network.target debvisor-rpcd.service\n    Requires=debvisor-rpcd.service\n    [Service]\n    Type=simple\n    User=debvisor\n    ExecStart=/opt/web/panel/bin/panel --config /etc/debvisor/panel.conf\n    Restart=always\n    [Install]\n    WantedBy=multi-user.target\n\n### Timer Units\n\n- *debvisor-health-check.timer**- Regular health checks\n\n    [Unit]\n    Description=DebVisor Health Check Timer\n    [Timer]\n    OnBootSec=5min\n    OnUnitActiveSec=5min\n    AccuracySec=1min\n    [Install]\n    WantedBy=timers.target\n\n- *debvisor-cleanup.timer**- Periodic cleanup\n\n    [Unit]\n    Description=DebVisor Cleanup Timer\n    [Timer]\n    OnCalendar=daily\n    OnCalendar=*-*-* 02:00:00\n    AccuracySec=5min\n    [Install]\n    WantedBy=timers.target\n\n## Configuration Best Practices\n\n### Service Requirements\n\n1.**Security Hardening**\n       PrivateTmp=yes\n       ProtectSystem=strict\n       ProtectHome=yes\n       NoNewPrivileges=yes\n    1.**Resource Limits**\n   MemoryMax=2G\n   CPUQuota=50%\n   TasksMax=1000\n    1.**Restart Policy**\n       Restart=on-failure\n       RestartSec=10s\n       StartLimitInterval=60s\n       StartLimitBurst=3\n\n### Timer Best Practices\n\n1. Use `OnBootSec` for startup delays\n\n1. Use `OnUnitActiveSec` for regular intervals\n\n1. Set `AccuracySec` to balance timing and system load\n\n1. Document purpose in `[Unit] Description`\n\n## Validation\n\n### Configuration Validation\n\n## Validate all service files\n\n    systemd-analyze verify etc/systemd/system/*.service\n\n## Check timer definitions\n\n    systemd-analyze verify-times etc/systemd/system/*.timer\n\n## Pre-flight checks\n\n    debvisor-validate-config etc/\n\n## Service Testing\n\n## Test service startup (no actual start)\n\n    systemd-analyze --scope user verify etc/systemd/user/*.service\n\n## Check dependencies\n\n    systemctl list-dependencies debvisor-rpcd.service\n\n## Troubleshooting\n\n### Common Issues\n\n### Service fails to start\n\n## Check service logs\n\n    journalctl -u debvisor-rpcd.service -n 50\n\n## Verify configuration syntax\n\n    systemd-analyze verify etc/systemd/system/debvisor-rpcd.service\n\n## Check dependencies [2]\n\n    systemctl list-dependencies --all debvisor-rpcd.service\n\n## Timer doesn't run\n\n## Check timer status\n\n    systemctl list-timers debvisor-health-check.timer\n\n## View last run\n\n    journalctl -u debvisor-health-check.timer\n\n## Manual trigger for testing\n\n    systemctl start debvisor-health-check.timer\n\n## Configuration changed but not applied\n\n## Reload systemd manager\n\n    systemctl daemon-reload\n\n## Verify changes\n\n    systemd-analyze diff before after\n\n## Security Hardening\n\n### Service Security\n\n1.**User privileges**: Run as non-root\n1.**File permissions**: Restrict config file access (600 or 640)\n1.**Secrets management**: Use systemd credentials or external vault\n1.**Network**: Use specific ports and protocols\n1.**Resource limits**: Prevent DoS and resource exhaustion\n\n### Configuration Security\n\n## Check file permissions\n\n    find etc/ -type f ! -perm 644 -print\n    find etc/ -type d ! -perm 755 -print\n\n## Validate no secrets in plain text\n\n    grep -r "password\|secret\|token" etc/ || echo "OK"\n\n## Check ownership\n\n    stat -c '%A %u:%g %n' etc/debvisor/*\n\n## Integration Points\n\n- **Logging**: All services integrate with systemd journal\n\n- **Monitoring**: Prometheus metrics from service status\n\n- **Health**: debvisor-health-check validates services\n\n- **Audit**: All configuration changes logged\n\n- **Dependencies**: Clear service dependency graph\n\n## References\n\n- systemd documentation: [https://systemd.io/]([https://systemd.io]([https://systemd.i](https://systemd.i)o)/)\n\n- Service file format: `man 5 systemd.service`\n\n- Timer format: `man 5 systemd.timer`\n\n- Best practices: [https://www.freedesktop.org/wiki/Software/systemd/]([https://www.freedesktop.org/wiki/Software/systemd]([https://www.freedesktop.org/wiki/Software/system](https://www.freedesktop.org/wiki/Software/system)d)/)\n\n
