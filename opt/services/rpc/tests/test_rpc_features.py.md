# Code Issues Report: opt\services\rpc\tests\test_rpc_features.py

Generated: 2025-12-13T15:17:32.581350
Source: opt\services\rpc\tests\test_rpc_features.py

## Issues Summary

Total: 51 issues found

| Line | Column | Tool | Code | Severity | Message |
|------|--------|------|------|----------|---------|
| 57 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 60 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 61 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 69 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 70 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 71 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 74 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 86 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 105 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 114 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 115 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 116 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 139 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 143 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 160 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 161 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 192 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 197 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 205 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 206 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 207 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 216 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 227 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 237 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 238 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 239 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 251 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 269 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 270 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 277 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 288 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 289 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 290 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 308 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 309 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 328 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 339 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 343 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 360 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 361 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 362 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 377 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 378 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 379 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 390 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 391 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 413 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 420 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 436 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 440 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 445 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |

## Implementation Status

Items marked below as fixed:


## Fix Proposals

**51 issues to fix:**


### Issue at Line 57

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
    async def test_pool_initialization(self, pool_config: PoolConfig) -> None:
        """Test pool initializes with minimum connections."""
        pool = ConnectionPool("localhost:50051", pool_config)
        assert pool._initialized is False

        await pool.initialize()
        assert pool._initialized is True
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 60

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        assert pool._initialized is False

        await pool.initialize()
        assert pool._initialized is True
        assert len(pool.available_connections) >= pool_config.min_connections    # type: ignore

    @pytest.mark.asyncio
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 61

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        await pool.initialize()
        assert pool._initialized is True
        assert len(pool.available_connections) >= pool_config.min_connections    # type: ignore

    @pytest.mark.asyncio
    async def test_pool_acquire_release(self, pool: ConnectionPool) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 69

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        initial_available = len(pool.available_connections)

        async with pool.acquire() as conn:
            assert conn is not None
            assert len(pool.available_connections) < initial_available
            assert conn in pool.in_use_connections

```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 70

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        async with pool.acquire() as conn:
            assert conn is not None
            assert len(pool.available_connections) < initial_available
            assert conn in pool.in_use_connections

        # After release, connection should be back in available pool
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 71

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        async with pool.acquire() as conn:
            assert conn is not None
            assert len(pool.available_connections) < initial_available
            assert conn in pool.in_use_connections

        # After release, connection should be back in available pool
        assert len(pool.available_connections) == initial_available
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 74

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
            assert conn in pool.in_use_connections

        # After release, connection should be back in available pool
        assert len(pool.available_connections) == initial_available

    @pytest.mark.asyncio
    async def test_pool_max_connections_limit(self, pool: ConnectionPool) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 86

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
            ctx = pool.acquire()
            conn = await ctx.__aenter__()
            connections.append(ctx)
            assert conn is not None

        # Fourth acquire should timeout
        with pytest.raises(TimeoutError):
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 105

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
            conn2_id = id(conn2)

        # Same connection object should be reused
        assert conn1_id == conn2_id

    @pytest.mark.asyncio
    async def test_pool_metrics(self, pool: ConnectionPool) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 114

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
            pass

        metrics = pool.get_metrics()
        assert metrics["reused"] > 0
        assert metrics["available"] >= 0
        assert metrics["in_use"] == 0

```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 115

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        metrics = pool.get_metrics()
        assert metrics["reused"] > 0
        assert metrics["available"] >= 0
        assert metrics["in_use"] == 0

    @pytest.mark.asyncio
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 116

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        metrics = pool.get_metrics()
        assert metrics["reused"] > 0
        assert metrics["available"] >= 0
        assert metrics["in_use"] == 0

    @pytest.mark.asyncio
    async def test_pool_close(self, pool: ConnectionPool) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 139

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        pool.config.connection_ttl_seconds = 1

        conn = PooledConnection(mock_channel, pool)
        assert not conn.is_stale()

        # Simulate age
        conn.created_at -= 2    # 2 seconds ago
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 143

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        # Simulate age
        conn.created_at -= 2    # 2 seconds ago
        assert conn.is_stale()

    @pytest.mark.asyncio
    async def test_connection_health_check(self) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 160

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        with patch("grpc.health.v1.health_pb2_grpc.HealthStub") as mock_health:  # type: ignore[name-defined]
            mock_health.return_value.Check.return_value = mock_response
            result = await conn.health_check()
            assert result is True
            assert conn.healthy is True


```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 161

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
            mock_health.return_value.Check.return_value = mock_response
            result = await conn.health_check()
            assert result is True
            assert conn.healthy is True


# ============================================================================
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 192

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        # Small payload should not compress
        algo = manager.select_algorithm(small_payload_size)
        assert algo == CompressionAlgorithm.NONE

        # Large payload should compress
        large_payload_size = 5000
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 197

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        # Large payload should compress
        large_payload_size = 5000
        algo = manager.select_algorithm(large_payload_size)
        assert algo in [CompressionAlgorithm.GZIP, CompressionAlgorithm.BROTLI]

    def test_gzip_compression(self, manager: CompressionManager) -> None:
        """Test GZIP compression."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 205

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        compressed, algo = manager.compress(data, CompressionAlgorithm.GZIP)

        assert algo == CompressionAlgorithm.GZIP
        assert len(compressed) < len(data)
        assert compressed.startswith(b"\x1f\x8b")    # GZIP magic number

```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 206

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        compressed, algo = manager.compress(data, CompressionAlgorithm.GZIP)

        assert algo == CompressionAlgorithm.GZIP
        assert len(compressed) < len(data)
        assert compressed.startswith(b"\x1f\x8b")    # GZIP magic number

    def test_gzip_decompression(self, manager: CompressionManager) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 207

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        assert algo == CompressionAlgorithm.GZIP
        assert len(compressed) < len(data)
        assert compressed.startswith(b"\x1f\x8b")    # GZIP magic number

    def test_gzip_decompression(self, manager: CompressionManager) -> None:
        """Test GZIP decompression."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 216

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        compressed, algo = manager.compress(original_data, CompressionAlgorithm.GZIP)
        decompressed = manager.decompress(compressed, algo)

        assert decompressed == original_data

    def test_compression_no_benefit(self, manager: CompressionManager) -> None:
        """Test that compression is skipped if it doesn't reduce size."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 227

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        # If compression increases size, should return NONE
        if len(compressed) >= len(data):
            assert algo == CompressionAlgorithm.NONE

    def test_compression_metrics(self, manager: CompressionManager) -> None:
        """Test compression metrics tracking."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 237

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        manager.compress(data, CompressionAlgorithm.GZIP)

        metrics = manager.get_metrics()
        assert metrics["total_requests"] > 0
        assert metrics["compressed_requests"] > 0
        assert 0 < metrics["compression_ratio"] < 1

```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 238

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        metrics = manager.get_metrics()
        assert metrics["total_requests"] > 0
        assert metrics["compressed_requests"] > 0
        assert 0 < metrics["compression_ratio"] < 1

    def test_compression_error_handling(self, manager: CompressionManager) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 239

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        metrics = manager.get_metrics()
        assert metrics["total_requests"] > 0
        assert metrics["compressed_requests"] > 0
        assert 0 < metrics["compression_ratio"] < 1

    def test_compression_error_handling(self, manager: CompressionManager) -> None:
        """Test error handling in compression."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 251

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        # Metrics should record error
        metrics = manager.get_metrics()
        assert metrics["errors"] > 0


# ============================================================================
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 269

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
    def test_supported_versions(self, negotiator: VersionNegotiator) -> None:
        """Test listing supported versions."""
        supported = negotiator.get_supported_versions()
        assert "1.0" in supported
        assert "2.0" in supported

    def test_version_negotiation_client_preference(self, negotiator: VersionNegotiator) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 270

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        """Test listing supported versions."""
        supported = negotiator.get_supported_versions()
        assert "1.0" in supported
        assert "2.0" in supported

    def test_version_negotiation_client_preference(self, negotiator: VersionNegotiator) -> None:
        """Test version negotiation respects client preference."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 277

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        client_versions = ["2.0", "1.0"]
        negotiated = negotiator.negotiate_version(client_versions)

        assert negotiated == "2.0"    # Highest client version

    def test_version_negotiation_fallback(self, negotiator: VersionNegotiator) -> None:
        """Test version negotiation fallback to server version."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 288

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

    def test_version_validation(self, negotiator: VersionNegotiator) -> None:
        """Test version validation."""
        assert negotiator.validate_version("1.0") is True
        assert negotiator.validate_version("2.0") is True
        assert negotiator.validate_version("99.0") is False

```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 289

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
    def test_version_validation(self, negotiator: VersionNegotiator) -> None:
        """Test version validation."""
        assert negotiator.validate_version("1.0") is True
        assert negotiator.validate_version("2.0") is True
        assert negotiator.validate_version("99.0") is False

    def test_deprecation_warnings(self, negotiator: VersionNegotiator) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 290

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        """Test version validation."""
        assert negotiator.validate_version("1.0") is True
        assert negotiator.validate_version("2.0") is True
        assert negotiator.validate_version("99.0") is False

    def test_deprecation_warnings(self, negotiator: VersionNegotiator) -> None:
        """Test deprecation warnings."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 308

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        negotiator.negotiate_version(["2.0"])

        metrics = negotiator.get_adoption_metrics()
        assert metrics["1.0"] == 1
        assert metrics["2.0"] == 2


```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 309

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        metrics = negotiator.get_adoption_metrics()
        assert metrics["1.0"] == 1
        assert metrics["2.0"] == 2


class TestVersionedRouter:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 328

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        router.register_handler(APIVersion.V1_0, "list_nodes", mock_handler)

        assert "list_nodes" in router.handlers[APIVersion.V1_0]

    def test_request_routing(self, router: VersionedRequestRouter) -> None:
        """Test routing requests to appropriate handlers."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 339

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        router.register_handler(APIVersion.V2_0, "list_nodes", mock_handler_v2)

        result = router.route("1.0", "list_nodes", arg1="value1")
        assert result == "v1_result"
        mock_handler_v1.assert_called_once_with(arg1="value1")

        result = router.route("2.0", "list_nodes", arg1="value2")
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 343

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        mock_handler_v1.assert_called_once_with(arg1="value1")

        result = router.route("2.0", "list_nodes", arg1="value2")
        assert result == "v2_result"
        mock_handler_v2.assert_called_once_with(arg1="value2")

    def test_operation_not_found(self, router: VersionedRequestRouter) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 360

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        router.register_handler(APIVersion.V2_0, "list_nodes", Mock())  # type: ignore[name-defined]

        matrix = router.get_compatibility_matrix()
        assert "list_nodes" in matrix["1.0"]
        assert "get_node" in matrix["1.0"]
        assert "list_nodes" in matrix["2.0"]

```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 361

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        matrix = router.get_compatibility_matrix()
        assert "list_nodes" in matrix["1.0"]
        assert "get_node" in matrix["1.0"]
        assert "list_nodes" in matrix["2.0"]


```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 362

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        matrix = router.get_compatibility_matrix()
        assert "list_nodes" in matrix["1.0"]
        assert "get_node" in matrix["1.0"]
        assert "list_nodes" in matrix["2.0"]


class TestBackwardCompatibility:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 377

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        v2_response = BackwardCompatibilityLayer.convert_v1_response_to_v2(v1_response)

        assert "nodes_list" in v2_response
        assert "status_code" in v2_response
        assert v2_response["status_code"] == 200

```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 378

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        v2_response = BackwardCompatibilityLayer.convert_v1_response_to_v2(v1_response)

        assert "nodes_list" in v2_response
        assert "status_code" in v2_response
        assert v2_response["status_code"] == 200

    def test_v2_to_v1_request_conversion(self) -> None:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 379

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        assert "nodes_list" in v2_response
        assert "status_code" in v2_response
        assert v2_response["status_code"] == 200

    def test_v2_to_v1_request_conversion(self) -> None:
        """Test converting V2 request to V1 format."""
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 390

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        v1_request = BackwardCompatibilityLayer.convert_v2_request_to_v1(v2_request)

        assert "pool_id" not in v1_request
        assert "filter" in v1_request


```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 391

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
        v1_request = BackwardCompatibilityLayer.convert_v2_request_to_v1(v2_request)

        assert "pool_id" not in v1_request
        assert "filter" in v1_request


# ============================================================================
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 413

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        # Test acquiring connection and compressing data
        async with pool.acquire() as conn:
            assert conn is not None

            # Test compression
            data = b"Test data " * 100
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 420

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
            compressed, algo = compression_manager.compress(data)
            decompressed = compression_manager.decompress(compressed, algo)

            assert decompressed == data

        await pool.close()

```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 436

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        # Negotiate version
        negotiated_version = negotiator.negotiate_version(["2.0", "1.0"])
        assert negotiated_version in ["1.0", "2.0"]

        # Acquire connection
        async with pool.acquire() as conn:
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 440

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```

        # Acquire connection
        async with pool.acquire() as conn:
            assert conn is not None

            # Compress data
            data = b"Integration test data " * 50
```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 445

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

**Context:**
```
            # Compress data
            data = b"Integration test data " * 50
            compressed, algo = compression_manager.compress(data)
            assert len(compressed) < len(data)

        await pool.close()

```

**Proposal:**
- Review the issue message above
- Consider the context code
- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)
- Ensure the fix aligns with the codebase style and the context.md guidelines

---

## Implementation Progress

To mark an issue as fixed, add the issue code to the line below with a âœ… emoji:

**Fixed Issues:** (none yet)

---
*Updated: (auto-populated by coding expert)*
