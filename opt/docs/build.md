# DebVisor ISO Build\n\nThis document explains how to build the DebVisor ISO using the helper script.\n\n## Prerequisites\n\n- A Debian-based build environment with `live-build`(`lb`) installed.\n\n- This repository checked out on the build machine.\n\n## Basic build\n\nFrom the project root:\n    ./build/build-debvisor.sh\nThis will:\n\n- Clean any previous build artifacts.\n\n- Configure `live-build` for the default Debian distribution and architecture.\n\n- Build an ISO named `live-image-amd64.hybrid.iso` in the project root (by default).\n\n## Environment variables\n\nThe build script can be customized via environment variables.\n\n### `DEBVISOR_DIST`\n\nTarget Debian distribution for the ISO.\n\n- **Default:**`bookworm`\n\n- **Example:**\n\n    DEBVISOR_DIST=trixie ./build/build-debvisor.sh\n\n### `DEBVISOR_FAST`\n\nControl whether the build script runs `lb clean` before building.\n\n- `0` (default): Perform a full clean before configuring and building.\n\n- `1`: Skip`lb clean` to speed up iterative builds.\n\n- **Example:**\n\n    DEBVISOR_FAST=1 ./build/build-debvisor.sh\nYou can combine both variables:\n    DEBVISOR_DIST=trixie DEBVISOR_FAST=1 ./build/build-debvisor.sh\n\n### `DEBVISOR_ARCH`\n\nTarget architecture for the ISO.\n\n- **Default:**`amd64`\n\n- **Examples:**\n\n    DEBVISOR_ARCH=arm64 ./build/build-debvisor.sh\n    DEBVISOR_ARCH=riscv64 ./build/build-debvisor.sh\nActual success depends on `live-build` and Debian support for that architecture on your build host (amd64 is the primary, best-tested target).\n\n### `DEBVISOR_VERSION`\n\nOptional version tag used to construct a more descriptive ISO filename.\n\n- **Default:**empty (keeps the original `live-image-amd64.hybrid.iso` name)\n\n- **Example:**\n\n    DEBVISOR_VERSION=0.2.0 ./build/build-debvisor.sh\nThis will produce an ISO named `debvisor-0.2.0-amd64.hybrid.iso`(or`debvisor-0.2.0-.hybrid.iso`if you also set`DEBVISOR_ARCH`).\n\n### Mirror and firmware options\n\nThese toggle where packages come from and whether firmware is included:\n\n- `DEBVISOR_MIRROR_BOOTSTRAP`- Bootstrap mirror URL (default:`[http://deb.debian.org/debian/]([http://deb.debian.org/debian](http://deb.debian.org/debian)/)`).\n\n- `DEBVISOR_MIRROR_BINARY`- Binary mirror URL (default:`[http://deb.debian.org/debian/]([http://deb.debian.org/debian](http://deb.debian.org/debian)/)`).\n\n- `DEBVISOR_FIRMWARE_CHROOT`-`true`/`false`, include firmware in chroot (default:`true`).\n\n- `DEBVISOR_FIRMWARE_BINARY`-`true`/`false`, include firmware in binary (default:`true`).\n\nExample overriding mirrors only:\n    DEBVISOR_MIRROR_BOOTSTRAP=[http://deb.debian.org/debian/]([http://deb.debian.org/debian](http://deb.debian.org/debian)/) \\n    DEBVISOR_MIRROR_BINARY=[http://deb.debian.org/debian/]([http://deb.debian.org/debian](http://deb.debian.org/debian)/) \\n    ./build/build-debvisor.sh\n\n### `DEBVISOR_SELFTEST`\n\nEnable a quick self-test mode that runs configuration and preflight checks but skips the expensive ISO build.\n\n- `0` (default): Full build (config + ISO).\n\n- `1`: Run preflight and`lb config`, then exit before`lb build`.\n\nExample (useful for CI):\n    DEBVISOR_SELFTEST=1 ./build/build-debvisor.sh\n\n## Helper scripts\n\nThe build script is aware of a couple of optional helper scripts:\n\n- `build/sync-addons-playbook.sh` (optional):\n\n- If present and executable, it is run automatically before `lb build`.\n\n- Use this to keep the embedded Ansible addons playbook in sync.\n\n- `build/test-firstboot.sh` (optional):\n\n- If present and executable, the build script will print a hint after a successful build.\n\n- Use this to run any post-build smoke tests for the `debvisor-firstboot.sh` logic.\n\n## Output\n\nOn success, the script prints the path to the generated ISO:\n    [DebVisor] Build complete: /path/to/live-image-amd64.hybrid.iso\nYou can then write this ISO to a USB stick using your preferred tool (e.g. `dd`,`balenaEtcher`,`Rufus`).\n\n
