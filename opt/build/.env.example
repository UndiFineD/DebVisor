# DebVisor Build Configuration (.env.example)
#
# Copy this file to .env and customize for your environment:
#   cp .env.example .env
#   vi .env
#
# Then source it before building:
#   source .env
#   ./build-debvisor.sh
#
# Or export variables directly:
#   export DEBVISOR_DIST=trixie
#   ./build-debvisor.sh

# ========== TARGET ENVIRONMENT ==========

# Debian distribution to build
# Options: bookworm (stable), trixie (testing), sid (unstable)
# Default: trixie
DEBVISOR_DIST=trixie

# Target architecture
# Options: amd64, arm64
# Default: amd64
DEBVISOR_ARCH=amd64

# Optional version tag (embedded in ISO filename)
# Example: 1.0.0, 2024-11-26
# Default: (empty - no version in filename)
DEBVISOR_VERSION=

# ========== BUILD OPTIMIZATION ==========

# Build mode (controls lb clean/config behavior)
# 0 = full clean + config (default, safest, slowest ~30-60 min)
# 1 = skip clean, reuse cache (~10-15 min)
# 2 = skip clean + config, fastest (~5-10 min, for final builds only)
# Default: 0
DEBVISOR_FAST=0

# Verbose output (show all lb/debootstrap output)
# 0 = minimal output
# 1 = show all commands and output
# Default: 0
DEBVISOR_VERBOSE=0

# CI mode (optimize for CI pipelines)
# 0 = normal mode
# 1 = CI mode (parallel builds, minimal output)
# Default: 0
DEBVISOR_CI_MODE=0

# ========== PACKAGE MIRRORS ==========

# Primary mirror for bootstrap (base packages)
# Default: http://deb.debian.org/debian/
# Alternatives:
#   - http://ftp.fr.debian.org/debian/
#   - http://ftp.us.debian.org/debian/
#   - http://mirror.example.com/debian/
DEBVISOR_MIRROR_BOOTSTRAP=http://deb.debian.org/debian/

# Fallback mirror if primary is unreachable
# Default: http://mirror.example.com/debian/
# Leave empty to disable fallback
DEBVISOR_MIRROR_BOOTSTRAP_FALLBACK=

# Binary mirror (live filesystem packages)
# Default: http://deb.debian.org/debian/
DEBVISOR_MIRROR_BINARY=http://deb.debian.org/debian/

# ========== FIRMWARE & DRIVERS ==========

# Include firmware in chroot (build time)
# 0 = exclude firmware packages
# 1 = include firmware (recommended for production)
# Default: true
DEBVISOR_FIRMWARE_CHROOT=true

# Include firmware in binary (runtime)
# 0 = exclude firmware
# 1 = include firmware (recommended for production)
# Default: true
DEBVISOR_FIRMWARE_BINARY=true

# ========== SIGNING & VERIFICATION ==========

# Sign ISO with GPG (creates .asc signature file)
# 0 = do not sign
# 1 = sign with GPG key
# Default: 0
DEBVISOR_SIGN_ISO=0

# GPG key ID to use for signing (if DEBVISOR_SIGN_ISO=1)
# Example: 0x1234ABCD, F00BA123
# Leave empty to use default GPG key
# Default: (empty - uses default key)
DEBVISOR_GPG_KEY=

# Verify checksums after download
# 0 = skip verification
# 1 = verify SHA256 checksums (recommended)
# Default: 1
DEBVISOR_CHECKSUM_VERIFY=1

# ========== ERROR HANDLING & DEBUGGING ==========

# Preserve build artifacts on failure (aids debugging)
# 0 = clean up on failure
# 1 = keep artifacts for inspection
# Default: 1
DEBVISOR_PRESERVE_ARTIFACTS=1

# Dry-run mode (validate without actually building)
# 0 = normal build
# 1 = validate configuration only, skip lb build
# Default: 0
DEBVISOR_DRYRUN=0

# ========== ADVANCED SETTINGS ==========

# Live-build configuration backend
# Options: auto, live-build
# Default: auto (detects from available tools)
# DEBVISOR_LB_BACKEND=auto

# Build log file path
# Default: build.log
# DEBVISOR_LOG_FILE=build.log

# Temporary build directory
# Default: /tmp/debvisor-build-${PID}
# Leave empty for automatic temp directory
# DEBVISOR_BUILD_TMPDIR=

# ========== MULTI-BUILD MATRIX ==========

# For CI/CD, build multiple configurations in parallel:
#
# Ubuntu Actions example:
#   for dist in bookworm trixie; do
#     for arch in amd64 arm64; do
#       (
#         source .env
#         export DEBVISOR_DIST=$dist
#         export DEBVISOR_ARCH=$arch
#         export DEBVISOR_CI_MODE=1
#         ./build-debvisor.sh
#       ) &
#     done
#   done
#   wait

# ========== QUICK PRESETS ==========

# PRESET 1: Lab/Development (fast, minimal validation)
# DEBVISOR_DIST=trixie
# DEBVISOR_ARCH=amd64
# DEBVISOR_FAST=2
# DEBVISOR_VERBOSE=1
# DEBVISOR_PRESERVE_ARTIFACTS=1

# PRESET 2: CI/Release (full validation, sign, parallelize)
# DEBVISOR_DIST=bookworm
# DEBVISOR_ARCH=amd64
# DEBVISOR_VERSION=1.0.0
# DEBVISOR_SIGN_ISO=1
# DEBVISOR_CI_MODE=1
# DEBVISOR_CHECKSUM_VERIFY=1

# PRESET 3: Production (comprehensive, secure)
# DEBVISOR_DIST=bookworm
# DEBVISOR_ARCH=amd64
# DEBVISOR_VERSION=1.0.0
# DEBVISOR_SIGN_ISO=1
# DEBVISOR_GPG_KEY=0xYOUR_KEY_ID
# DEBVISOR_VERBOSE=0
# DEBVISOR_PRESERVE_ARTIFACTS=1
# DEBVISOR_CHECKSUM_VERIFY=1
