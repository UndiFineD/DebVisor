# Code Issues Report: tests\test_api_key_manager.py

Generated: 2025-12-13T15:07:52.431185
Source: tests\test_api_key_manager.py

## Issues Summary

Total: 51 issues found

| Line | Column | Tool | Code | Severity | Message |
|------|--------|------|------|----------|---------|
| 58 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 59 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 62 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 63 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 64 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 65 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 76 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 77 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 78 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 79 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 85 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 97 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 118 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 119 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 120 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 121 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 125 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 128 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 143 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 144 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 145 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 146 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 162 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 163 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 167 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 185 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 189 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 215 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 219 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 237 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 238 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 261 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 262 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 279 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 280 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 299 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 304 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 321 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 322 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 326 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 342 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 359 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 363 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 364 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 387 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 388 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 389 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 390 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 391 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 404 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |
| 405 | 0 | bandit | `B101` | LOW | Use of assert detected. The enclosed code will be removed when compiling to optimised byte code. |

## Implementation Status

Items marked below as fixed:

## Fix Proposals

### 51 issues to fix

### Issue at Line 58

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        )

        # Verify key format
        assert api_key.startswith("dv_")
        assert len(api_key) == 67    # "dv_" + 64 hex chars

        # Verify key object
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 59

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify key format
        assert api_key.startswith("dv_")
        assert len(api_key) == 67    # "dv_" + 64 hex chars

        # Verify key object
        assert key_obj.principal_id == "user@test.com"
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 62

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        assert len(api_key) == 67    # "dv_" + 64 hex chars

        # Verify key object
        assert key_obj.principal_id == "user@test.com"
        assert key_obj.status == KeyStatus.ACTIVE
        assert key_obj.use_count == 0
        assert key_obj.description == "Test key"
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 63

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify key object
        assert key_obj.principal_id == "user@test.com"
        assert key_obj.status == KeyStatus.ACTIVE
        assert key_obj.use_count == 0
        assert key_obj.description == "Test key"

```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 64

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        # Verify key object
        assert key_obj.principal_id == "user@test.com"
        assert key_obj.status == KeyStatus.ACTIVE
        assert key_obj.use_count == 0
        assert key_obj.description == "Test key"

    def test_validate_key(self, key_manager):
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 65

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        assert key_obj.principal_id == "user@test.com"
        assert key_obj.status == KeyStatus.ACTIVE
        assert key_obj.use_count == 0
        assert key_obj.description == "Test key"

    def test_validate_key(self, key_manager):
        """Test API key validation."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 76

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Validate key
        validated = key_manager.validate_key(api_key)
        assert validated is not None
        assert validated.key_id == key_obj.key_id
        assert validated.principal_id == "user@test.com"
        assert validated.use_count == 1    # Incremented on validation
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 77

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        # Validate key
        validated = key_manager.validate_key(api_key)
        assert validated is not None
        assert validated.key_id == key_obj.key_id
        assert validated.principal_id == "user@test.com"
        assert validated.use_count == 1    # Incremented on validation

```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 78

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        validated = key_manager.validate_key(api_key)
        assert validated is not None
        assert validated.key_id == key_obj.key_id
        assert validated.principal_id == "user@test.com"
        assert validated.use_count == 1    # Incremented on validation

    def test_validate_invalid_key(self, key_manager):
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 79

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        assert validated is not None
        assert validated.key_id == key_obj.key_id
        assert validated.principal_id == "user@test.com"
        assert validated.use_count == 1    # Incremented on validation

    def test_validate_invalid_key(self, key_manager):
        """Test validation of invalid key."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 85

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        """Test validation of invalid key."""
        invalid_key = "dv_" + "0" * 64
        validated = key_manager.validate_key(invalid_key)
        assert validated is None

    def test_key_usage_tracking(self, key_manager):
        """Test that key usage is tracked."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 97

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        # Use key multiple times
        for i in range(5):
            validated = key_manager.validate_key(api_key)
            assert validated.use_count == i + 1

class TestKeyRotation:
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 118

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        )

        # Verify new key
        assert new_api_key != old_api_key
        assert new_key_obj.key_id != old_key_obj.key_id
        assert new_key_obj.principal_id == old_key_obj.principal_id
        assert new_key_obj.status == KeyStatus.ACTIVE
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 119

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify new key
        assert new_api_key != old_api_key
        assert new_key_obj.key_id != old_key_obj.key_id
        assert new_key_obj.principal_id == old_key_obj.principal_id
        assert new_key_obj.status == KeyStatus.ACTIVE

```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 120

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        # Verify new key
        assert new_api_key != old_api_key
        assert new_key_obj.key_id != old_key_obj.key_id
        assert new_key_obj.principal_id == old_key_obj.principal_id
        assert new_key_obj.status == KeyStatus.ACTIVE

        # Verify old key marked as expiring
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 121

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        assert new_api_key != old_api_key
        assert new_key_obj.key_id != old_key_obj.key_id
        assert new_key_obj.principal_id == old_key_obj.principal_id
        assert new_key_obj.status == KeyStatus.ACTIVE

        # Verify old key marked as expiring
        old_key_refreshed = key_manager.keys[old_key_obj.key_id]
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 125

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify old key marked as expiring
        old_key_refreshed = key_manager.keys[old_key_obj.key_id]
        assert old_key_refreshed.status == KeyStatus.EXPIRING

        # Verify rotation linkage
        assert old_key_refreshed.rotation_id == new_key_obj.rotation_id
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 128

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        assert old_key_refreshed.status == KeyStatus.EXPIRING

        # Verify rotation linkage
        assert old_key_refreshed.rotation_id == new_key_obj.rotation_id

    def test_rotated_key_overlap(self, key_manager):
        """Test that old key works during overlap period."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 143

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        old_validated = key_manager.validate_key(old_api_key)
        new_validated = key_manager.validate_key(new_api_key)

        assert old_validated is not None
        assert new_validated is not None
        assert old_validated.status == KeyStatus.EXPIRING
        assert new_validated.status == KeyStatus.ACTIVE
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 144

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        new_validated = key_manager.validate_key(new_api_key)

        assert old_validated is not None
        assert new_validated is not None
        assert old_validated.status == KeyStatus.EXPIRING
        assert new_validated.status == KeyStatus.ACTIVE

```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 145

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        assert old_validated is not None
        assert new_validated is not None
        assert old_validated.status == KeyStatus.EXPIRING
        assert new_validated.status == KeyStatus.ACTIVE

    def test_auto_rotate_expiring_keys(self, key_manager):
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 146

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        assert old_validated is not None
        assert new_validated is not None
        assert old_validated.status == KeyStatus.EXPIRING
        assert new_validated.status == KeyStatus.ACTIVE

    def test_auto_rotate_expiring_keys(self, key_manager):
        """Test automatic rotation of expiring keys."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 162

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        rotations = key_manager.auto_rotate_expiring_keys()

        # Verify rotation occurred
        assert len(rotations) == 1
        assert key_obj.key_id in rotations

        # Verify old key is expiring
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 163

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify rotation occurred
        assert len(rotations) == 1
        assert key_obj.key_id in rotations

        # Verify old key is expiring
        old_key = key_manager.keys[key_obj.key_id]
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 167

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify old key is expiring
        old_key = key_manager.keys[key_obj.key_id]
        assert old_key.status == KeyStatus.EXPIRING

class TestKeyRevocation:
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 185

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify key is revoked
        key_refreshed = key_manager.keys[key_obj.key_id]
        assert key_refreshed.status == KeyStatus.REVOKED

        # Verify revoked key doesn't validate
        validated = key_manager.validate_key(api_key)
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 189

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify revoked key doesn't validate
        validated = key_manager.validate_key(api_key)
        assert validated is None

    def test_revoke_nonexistent_key(self, key_manager):
        """Test revoking nonexistent key raises error."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 215

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify expired key is rejected
        validated = key_manager.validate_key(api_key)
        assert validated is None

        # Verify key status updated to expired
        key_refreshed = key_manager.keys[key_obj.key_id]
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 219

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify key status updated to expired
        key_refreshed = key_manager.keys[key_obj.key_id]
        assert key_refreshed.status == KeyStatus.EXPIRED

    def test_check_expiring_keys(self, key_manager):
        """Test identifying keys expiring soon."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 237

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        expiring = key_manager.check_expiring_keys()

        # Only second key should be expiring
        assert len(expiring) == 1
        assert expiring[0].principal_id == "user2@test.com"

```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 238

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Only second key should be expiring
        assert len(expiring) == 1
        assert expiring[0].principal_id == "user2@test.com"

class TestKeyCleanup:
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 261

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        removed = key_manager.cleanup_expired_keys(retention_days=365)

        # Verify key removed
        assert removed == 1
        assert key_obj.key_id not in key_manager.keys

    def test_cleanup_preserves_recent_expired(self, key_manager):
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 262

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify key removed
        assert removed == 1
        assert key_obj.key_id not in key_manager.keys

    def test_cleanup_preserves_recent_expired(self, key_manager):
        """Test that recent expired keys are preserved."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 279

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        removed = key_manager.cleanup_expired_keys(retention_days=365)

        # Key should be preserved
        assert removed == 0
        assert key_obj.key_id in key_manager.keys

```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 280

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Key should be preserved
        assert removed == 0
        assert key_obj.key_id in key_manager.keys

class TestKeyPersistence:
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 299

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify file created
        keys_file = Path(temp_storage) / "api_keys.json"
        assert keys_file.exists()

        # Verify content
        with open(keys_file, "r") as f:
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 304

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        # Verify content
        with open(keys_file, "r") as f:
            data = json.load(f)
            assert key_obj.key_id in data

    def test_keys_loaded_on_init(self, temp_storage):
        """Test that keys are loaded from disk on initialization."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 321

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        manager2 = APIKeyManager(config, temp_storage)

        # Verify key loaded
        assert key_obj.key_id in manager2.keys
        assert manager2.keys[key_obj.key_id].principal_id == "user@test.com"

        # Verify validation works
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 322

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify key loaded
        assert key_obj.key_id in manager2.keys
        assert manager2.keys[key_obj.key_id].principal_id == "user@test.com"

        # Verify validation works
        validated = manager2.validate_key(api_key)
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 326

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify validation works
        validated = manager2.validate_key(api_key)
        assert validated is not None

class TestAuditLogging:
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 342

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify audit log exists
        audit_log = Path(temp_storage) / "api_key_audit.log"
        assert audit_log.exists()

    def test_audit_log_entries(self, key_manager, temp_storage):
        """Test audit log entries are written."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 359

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
            lines = f.readlines()

        # Verify entries
        assert len(lines) >= 2    # create + rotate

        # Parse entries
        entries = [json.loads(line) for line in lines]
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 363

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Parse entries
        entries = [json.loads(line) for line in lines]
        assert entries[0]["event"] == "key_created"
        assert entries[1]["event"] == "key_rotated"

```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 364

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        # Parse entries
        entries = [json.loads(line) for line in lines]
        assert entries[0]["event"] == "key_created"
        assert entries[1]["event"] == "key_rotated"

class TestStatistics:
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 387

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        stats = key_manager.get_key_stats()

        # Verify stats
        assert stats["total_keys"] == 2
        assert stats["active_keys"] == 1
        assert stats["revoked_keys"] == 1
        assert stats["expired_keys"] == 0
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 388

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify stats
        assert stats["total_keys"] == 2
        assert stats["active_keys"] == 1
        assert stats["revoked_keys"] == 1
        assert stats["expired_keys"] == 0
        assert stats["expiring_keys"] == 0
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 389

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        # Verify stats
        assert stats["total_keys"] == 2
        assert stats["active_keys"] == 1
        assert stats["revoked_keys"] == 1
        assert stats["expired_keys"] == 0
        assert stats["expiring_keys"] == 0

```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 390

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        assert stats["total_keys"] == 2
        assert stats["active_keys"] == 1
        assert stats["revoked_keys"] == 1
        assert stats["expired_keys"] == 0
        assert stats["expiring_keys"] == 0

    def test_list_keys_for_principal(self, key_manager):
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 391

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        assert stats["active_keys"] == 1
        assert stats["revoked_keys"] == 1
        assert stats["expired_keys"] == 0
        assert stats["expiring_keys"] == 0

    def test_list_keys_for_principal(self, key_manager):
        """Test listing keys for a specific principal."""
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 404

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python
        user1_keys = key_manager.list_keys_for_principal("user1@test.com")

        # Verify results
        assert len(user1_keys) == 2
        assert all(k.principal_id == "user1@test.com" for k in user1_keys)
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

### Issue at Line 405

**Tool:** bandit | **Code:** `B101` | **Severity:** LOW

**Message:** Use of assert detected. The enclosed code will be removed when compiling to optimised byte code.

### Context

```python

        # Verify results
        assert len(user1_keys) == 2
        assert all(k.principal_id == "user1@test.com" for k in user1_keys)
```python

### Proposal

- Review the issue message above

- Consider the context code

- Apply the appropriate fix (e.g., fix linting error, add type hints, improve security)

- Ensure the fix aligns with the codebase style and the context.md guidelines

---

## Implementation Progress

To mark an issue as fixed, add the issue code to the line below with a âœ… emoji:

**Fixed Issues:** (none yet)

---
*Updated: (auto-populated by coding expert)*
